<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ねこずかん - 猫の図鑑＆コミュニティ</title>
  <meta name="description" content="猫の品種図鑑と、みんなの猫写真が集まるコミュニティサイト">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ========== ヘッダー ========== -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="site-logo"><span class="paw">🐱</span> ねこずかん</a>
      <nav class="header-nav">
        <a href="#zukan" class="nav-link">図鑑</a>
        <a href="#community" class="nav-link">コミュニティ</a>
        <a href="pages/post.html" class="btn btn-primary">＋ 投稿する</a>
      </nav>
    </div>
  </header>

  <!-- ========== ヒーロー ========== -->
  <section class="hero">
    <div class="container">
      <span class="hero-eyebrow">🐾 猫好きのための場所</span>
      <h1>
        <span class="hero-gradient">ねこずかん</span><br>
        猫図鑑＆フォトコミュニティ
      </h1>
      <p>猫の品種を調べたり、あなたの愛猫の写真をみんなとシェアしよう</p>
      <div class="hero-actions">
        <a href="#community" class="btn btn-primary">みんなの猫を見る</a>
        <a href="#zukan" class="btn btn-outline">図鑑を見る</a>
      </div>
    </div>
  </section>

  <!-- ========== ねこ図鑑 ========== -->
  <section class="section" id="zukan">
    <div class="container">
      <div class="section-header">
        <div class="section-badge">📚 図鑑</div>
        <h2 class="section-title">ねこずかん</h2>
        <p class="section-sub">人気の猫品種をご紹介します</p>
      </div>
      <div class="zukan-invite-banner">
        <span class="invite-banner-emoji">📷</span>
        <div class="invite-banner-text">
          <strong>地域の猫も大募集！</strong>
          <span>あなたの愛猫の写真を投稿して、みんなに紹介しよう</span>
        </div>
        <a href="pages/post.html" class="btn btn-primary">投稿する →</a>
      </div>
      <div class="zukan-grid" id="zukan-grid"></div>
    </div>
  </section>

  <!-- ========== コミュニティ ========== -->
  <section class="section feed-section" id="community">
    <div class="container">
      <div class="section-header">
        <div class="section-badge">📸 コミュニティ</div>
        <h2 class="section-title">みんなの猫フォト</h2>
        <p class="section-sub">ユーザーが投稿した愛猫の写真たち</p>
      </div>

      <div class="feed-controls">
        <div class="sort-tabs">
          <button class="sort-tab active" data-order="new">🕐 新着順</button>
          <button class="sort-tab" data-order="likes">💗 いいね順</button>
        </div>
      </div>

      <div class="post-grid" id="post-grid">
        <!-- カードがここに挿入される -->
      </div>

      <div class="feed-empty" id="feed-empty" style="display:none">
        <div class="emoji">🐱</div>
        <p>まだ投稿がありません。最初の投稿者になろう！</p>
        <a href="pages/post.html" class="btn btn-primary" style="margin-top:1rem">投稿する</a>
      </div>

      <div class="load-more-wrap" id="load-more-wrap" style="display:none">
        <button class="btn btn-outline" id="load-more-btn">もっと見る</button>
      </div>
    </div>
  </section>

  <!-- ========== フッター ========== -->
  <footer class="site-footer">
    <p>🐱 ねこずかん &copy; 2025 | 猫好きのための図鑑＆コミュニティ</p>
  </footer>

  <script type="module">
    import { fetchPosts, createPostCard, showToast } from './js/feed.js';

    // ========== 図鑑データ ==========
    const CATS = [
      // --- 既存6匹（絵文字カード） ---
      { id: 'american-shorthair', name: 'アメリカン・ショートヘア', en: 'American Shorthair', emoji: '🐱', image: 'images/american-shorthair.jpg', desc: '丸みのある顔と縞模様が特徴。温厚で社交的な性格。初めて猫を飼う方にもおすすめ。', traits: ['温厚', '社交的', '丈夫'] },
      { id: 'norwegian-forest', name: 'ノルウェージャン・フォレスト', en: 'Norwegian Forest Cat', emoji: '🦁', image: 'images/norwegian-forest.jpg', desc: '長くふわふわの被毛を持つ大型猫。独立心が強く、自然の中が大好き。', traits: ['独立心', '活発', '大型'] },
      { id: 'bengal', name: 'ベンガル', en: 'Bengal', emoji: '🐆', image: 'images/bengal.jpg', desc: 'ヒョウ柄のような斑点模様が特徴的。知的で活発、遊び好き。', traits: ['活発', '知的', 'ワイルド'] },
      { id: 'siamese', name: 'サイアミーズ', en: 'Siamese', emoji: '🗣️', image: 'images/siamese.jpg', desc: '青い目と色ポイントの模様が美しい。おしゃべりで感情表現が豊か。', traits: ['おしゃべり', '社交的', '甘えん坊'] },
      { id: 'maine-coon', name: 'メインクーン', en: 'Maine Coon', emoji: '🦊', image: 'images/maine-coon.jpg', desc: '世界最大の猫品種のひとつ。犬のように忠実でフレンドリー。', traits: ['大型', 'フレンドリー', '犬っぽい'] },
      // --- 写真付き詳細カード ---
      {
        id: 'ragdoll', name: 'ラグドール', en: 'Ragdoll', image: 'images/neko.jpg', emoji: '😻',
        origin: 'アメリカ', weight: '5〜9kg（大型）',
        traits: ['🧸 おとなしい', '甘えん坊', '室内向き'],
        desc: '「抱き人形」という名前の通り、抱き上げると全身の力を抜いてぐったりリラックスする世界でも珍しい猫。宝石のような澄んだブルーの瞳と、顔・耳・手足に現れる濃いポイントカラーが美しい。おとなしく攻撃性が低く、鳴き声も小さい室内飼い向きの品種。',
        recommend: 'まったりしたい人・初めて猫を飼う人',
      },
      {
        id: 'munchkin', name: 'マンチカン', en: 'Munchkin', image: 'images/munchkin.jpg', emoji: '🐾',
        origin: 'アメリカ', weight: '2〜4kg（小〜中型）',
        traits: ['🎀 活発', '人懐こい', '好奇心旺盛'],
        desc: '短い脚がトレードマークの「猫界のダックスフント」。遺伝子の自然突然変異によって生まれた品種。短足でも走ったりジャンプしたりと活発で、おもちゃで遊ぶのが大好き。人懐こく好奇心旺盛で、家族全員に愛嬌を振りまく。',
        recommend: 'にぎやかな家族・子どもがいる家庭',
      },
      {
        id: 'siberian', name: 'サイベリアン', en: 'Siberian', image: 'images/siberian.jpg', emoji: '❄️',
        origin: 'ロシア（シベリア地方）', weight: '5〜8kg（大型）',
        traits: ['❄️ 勇敢', '穏やか', '低アレルゲン'],
        desc: 'シベリアの極寒の大地で自然に生まれた、ロシア最古の猫種のひとつ。防水性の高い三層構造の被毛が特徴。見た目は野性的だが性格は穏やかで忠実。アレルゲンのFel d 1タンパク質の分泌量が少なく、猫アレルギーの人でも飼えるケースがある「低アレルゲン猫」としても知られる。',
        recommend: '猫アレルギーが心配な人・大型猫が好きな人',
      },
      {
        id: 'scottish', name: 'スコティッシュフォールド', en: 'Scottish Fold', image: 'images/scottish.jpg', emoji: '😸',
        origin: 'スコットランド', weight: '3〜6kg（中型）',
        traits: ['😊 温厚', 'マイペース', '適応力高い'],
        desc: '前に折れ曲がった耳が最大の特徴で、まるでぬいぐるみのような愛らしい顔立ちが人気。「お相撲座り」と呼ばれる、後ろ脚を前に投げ出した独特の座り方が有名。穏やかで適応力が高く、一人暮らしにも家族にも合いやすい万能な品種。',
        recommend: '一人暮らし・のんびりした雰囲気が好きな人',
      },
      {
        id: 'minuet', name: 'ミヌエット', en: 'Minuet（旧：ナポレオン）', image: 'images/minuet.jpg', emoji: '👑',
        origin: 'アメリカ', weight: '3〜5kg（小〜中型）',
        traits: ['👑 おっとり', '甘えん坊', '室内向き'],
        desc: 'ペルシャのゴージャスな長毛と丸い顔、マンチカンの短い脚を掛け合わせて誕生した比較的新しい品種。パステルカラーの被毛がぬいぐるみのよう。ペルシャ譲りの穏やかな気質とマンチカン譲りの好奇心と人懐こさを兼ね備え、ソファや膝の上でまったり過ごすのが好き。',
        recommend: 'まったり派・ふわふわ系の猫が好きな人',
      },
      {
        id: 'persian', name: 'ペルシャ', en: 'Persian', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/White_Persian_Cat.jpg/400px-White_Persian_Cat.jpg', emoji: '👸',
        origin: 'イラン（ペルシャ）', weight: '4〜6kg（中型）',
        traits: ['🌸 おっとり', 'ふわふわ長毛', '静かな室内派'],
        desc: '世界で最も歴史ある猫品種のひとつ。絹のように柔らかい長毛とつぶれた鼻・丸い顔が特徴で、感情表現は控えめながら飼い主と深い絆を結ぶ。穏やかでおっとりした性格のため静かな環境を好む。毎日のブラッシングが必要だが、その美しさと品のある佇まいは格別。',
        recommend: '静かな時間を大切にする人・美しい猫が好きな人',
      },
      {
        id: 'british-shorthair', name: 'ブリティッシュショートヘア', en: 'British Shorthair', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Britishblue.jpg/400px-Britishblue.jpg', emoji: '🎩',
        origin: 'イギリス', weight: '4〜7kg（中〜大型）',
        traits: ['🎩 落ち着いた紳士', '独立心が強い', 'どっしり丸顔'],
        desc: '丸い顔・丸い目・ずんぐりした体型が「テディベア猫」と呼ばれる所以。ブルーグレーの被毛（ブリティッシュブルー）が代表的。独立心が強く構いすぎを嫌うが、傍にいることを好む穏やかな性格。落ち着いていて吠えたり暴れたりしない、おしゃれで紳士的な猫。',
        recommend: '一人暮らし・独立心のある猫を好む人',
      },
      {
        id: 'russian-blue', name: 'ロシアンブルー', en: 'Russian Blue', image: 'https://upload.wikimedia.org/wikipedia/commons/a/ad/Russian_Blue_Cat_Looking_Up.jpg', emoji: '💎',
        origin: 'ロシア', weight: '3〜5kg（中型）',
        traits: ['💎 穏やかで繊細', '一途な忠誠心', 'スマイルフェイス'],
        desc: 'シルバーブルーの被毛と翡翠色の瞳が美しい優雅な猫。内気で見知らぬ人には警戒心を見せるが、信頼した飼い主には深く愛情を注ぐ一途な性格。「スマイルキャット」とも呼ばれる口角が上がった表情が特徴。静かでおとなしくマンション暮らしにも向いている。',
        recommend: '静かな環境・一対一の絆を大切にしたい人',
      },
      {
        id: 'sphynx', name: 'スフィンクス', en: 'Sphynx', image: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/20170604_Sphynx_cat_7984.jpg', emoji: '🤍',
        origin: 'カナダ', weight: '3〜5kg（中型）',
        traits: ['🔥 体温が高い', 'べったり甘えん坊', '毛がない独自の魅力'],
        desc: '毛がないユニークな見た目が世界中で話題の猫。自然突然変異から生まれたカナダ原産の品種。毛がない分体温が約1〜2℃高く、まるで湯たんぽのような温かさ。見た目に反して非常に社交的で甘えん坊、人が大好き。静電気・日焼け対策と定期的なお風呂が欠かせない。',
        recommend: 'ユニークな猫が好きな人・常にそばにいてほしい人',
      },
      {
        id: 'abyssinian', name: 'アビシニアン', en: 'Abyssinian', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Gustav_chocolate.jpg/400px-Gustav_chocolate.jpg', emoji: '🦅',
        origin: 'エチオピア（旧アビシニア）', weight: '3〜5kg（中型）',
        traits: ['🦅 好奇心旺盛', '運動神経抜群', 'スリムで俊敏'],
        desc: '古代エジプトの壁画に描かれた猫に最も近い品種のひとつ。黄金色〜レンガ色の短毛にティッキング（縞の一種）が入る美しい被毛を持つ。活発で運動神経が高く高い場所が大好き。知的で遊び好き、常に飼い主の行動に興味を示す観察眼の鋭い猫。',
        recommend: 'アクティブな生活スタイルの人・猫と一緒に遊びたい人',
      },
      {
        id: 'devon-rex', name: 'デボンレックス', en: 'Devon Rex', image: 'https://upload.wikimedia.org/wikipedia/commons/f/f7/Devon_Rex_male.jpg', emoji: '🧝',
        origin: 'イギリス（デボン州）', weight: '2〜4kg（小〜中型）',
        traits: ['🧝 妖精のような外見', '遊び好きで元気', '人懐こい'],
        desc: '大きな耳・くりくりの目・カールした短毛が妖精のような個性的な外見を作る猫。「プードルキャット」とも呼ばれる縮れた被毛は触り心地が柔らかい。とても人懐こく遊び好きで家の中を元気に駆け回る。社交的で犬のように飼い主を追いかける行動がかわいらしい。',
        recommend: '活発な猫が好きな人・個性的な猫に魅力を感じる人',
      },
      {
        id: 'turkish-angora', name: 'ターキッシュアンゴラ', en: 'Turkish Angora', image: 'https://upload.wikimedia.org/wikipedia/commons/7/7e/Turkish_Angora_cat.jpg', emoji: '🕊️',
        origin: 'トルコ（アンカラ）', weight: '3〜5kg（中型）',
        traits: ['🕊️ 優雅でしなやか', '知的で好奇心旺盛', '独立心がある'],
        desc: 'トルコの国宝に指定されるほど歴史ある長毛種。シルクのように細い被毛と流れるような長い尾が優雅。知的で好奇心旺盛、遊ぶことが大好きだが自分のペースを大切にする独立心も持つ。白猫が代表的でターコイズブルーやアンバーの瞳が印象的な気品ある品種。',
        recommend: '優雅な猫が好きな人・知性派の猫と暮らしたい人',
      },
      {
        id: 'birman', name: 'バーマン', en: 'Birman', image: 'https://upload.wikimedia.org/wikipedia/commons/7/76/Tallulah%2C_a_Seal-Point_Birman_cat.jpg', emoji: '🙏',
        origin: 'フランス（原産はミャンマー）', weight: '4〜7kg（中〜大型）',
        traits: ['🙏 神秘的な美しさ', '穏やかで従順', '白い手袋模様'],
        desc: '「ビルマの聖なる猫」とも呼ばれる神秘的な品種。四本の足先だけ白くなる「グローブ」と呼ばれる模様が特徴で、伝説では寺院の僧侶の魂が宿るとされる。ブルーの瞳とポイントカラーの半長毛が美しい。穏やかで人懐こく、子どもや他のペットとも仲良くできる優しい性格。',
        recommend: '家族みんなで猫を楽しみたい人・神秘的な猫が好きな人',
      },
      {
        id: 'burmese', name: 'バーミーズ', en: 'Burmese', image: 'https://upload.wikimedia.org/wikipedia/commons/8/84/Burmese_%28Cat%29.jpg', emoji: '✨',
        origin: 'ミャンマー（旧ビルマ）', weight: '3〜5kg（中型）',
        traits: ['✨ 愛情深い甘えん坊', '活発で遊び好き', '絹のような艶毛'],
        desc: '黄金色に輝く瞳と艶やかなサテン地のような短毛が美しい中型猫。「犬猫」と称されるほど人間に密着した愛情を示す甘えん坊の品種。活発で遊び好きな一面と、ひざの上でぐっすり眠る甘えたな一面を兼ね備える。鳴き声は控えめながら常に飼い主のそばにいたがる。',
        recommend: '常に猫に寄り添っていてほしい人・甘えん坊な猫が好きな人',
      },
      {
        id: 'exotic-shorthair', name: 'エキゾチックショートヘア', en: 'Exotic Shorthair', image: 'https://upload.wikimedia.org/wikipedia/commons/4/4f/Cream_tabby_exotic_cat.jpg', emoji: '🐼',
        origin: 'アメリカ', weight: '3〜6kg（中型）',
        traits: ['🐼 のんびり穏やか', 'お手入れが楽', '甘えん坊'],
        desc: '「短毛のペルシャ」とも呼ばれ、ペルシャの丸くつぶれた顔とどっしりした体型をそのままに、お手入れが楽な短毛を持つ品種。温厚でのんびりした性格はペルシャ譲り。抱っこが大好きで静かに飼い主のそばでくつろぐ。あの「グランピーキャット」もエキゾチックショートヘアの血を引く。',
        recommend: 'のんびりした猫が好きな人・お手入れが楽な猫を探している人',
      },
    ];

    function renderZukan() {
      const grid = document.getElementById('zukan-grid');
      CATS.forEach(cat => {
        const card = document.createElement('div');
        card.className = 'zukan-card';

        const imgContent = cat.image
          ? `<img src="${cat.image}" alt="${cat.name}" loading="lazy">`
          : `<span>${cat.emoji}</span>`;

        const metaHtml = (cat.origin || cat.weight) ? `
          <div class="zukan-card-meta">
            ${cat.origin ? `<span class="zukan-meta-item">🌍 ${cat.origin}</span>` : ''}
            ${cat.weight ? `<span class="zukan-meta-item">⚖️ ${cat.weight}</span>` : ''}
          </div>` : '';

        const recommendHtml = cat.recommend
          ? `<p class="zukan-card-recommend">💡 ${cat.recommend}</p>` : '';

        card.innerHTML = `
          <div class="zukan-card-img">${imgContent}</div>
          <div class="zukan-card-body">
            <h3 class="zukan-card-name">${cat.name}</h3>
            <p class="zukan-card-en">${cat.en}</p>
            ${metaHtml}
            <p class="zukan-card-desc">${cat.desc}</p>
            <div class="zukan-card-traits">${cat.traits.map(t => `<span class="trait-badge">${t}</span>`).join('')}</div>
            ${recommendHtml}
            <a href="pages/cat.html?id=${cat.id}" class="zukan-card-link">くわしく見る →</a>
          </div>
        `;

        // 画像読み込み失敗時のフォールバック
        if (cat.image) {
          const img = card.querySelector('.zukan-card-img img');
          img.addEventListener('error', () => {
            img.parentElement.innerHTML = `<span>${cat.emoji}</span>`;
          });
        }

        // カード全体クリックでも詳細ページへ
        card.style.cursor = 'pointer';
        card.addEventListener('click', (e) => {
          if (!e.target.closest('a')) {
            location.href = `pages/cat.html?id=${cat.id}`;
          }
        });

        grid.appendChild(card);
      });
    }

    // ========== フィード ==========
    let currentOrder = 'new';
    let offset = 0;
    let loading = false;

    async function loadFeed(reset = false) {
      if (loading) return;
      loading = true;
      if (reset) {
        offset = 0;
        document.getElementById('post-grid').innerHTML = '';
        document.getElementById('feed-empty').style.display = 'none';
        document.getElementById('load-more-wrap').style.display = 'none';
      }
      const loadMoreBtn = document.getElementById('load-more-btn');
      if (loadMoreBtn) { loadMoreBtn.disabled = true; loadMoreBtn.textContent = '読み込み中...'; }

      const posts = await fetchPosts({ offset, orderBy: currentOrder });
      const grid = document.getElementById('post-grid');
      posts.forEach(post => { grid.appendChild(createPostCard(post)); });

      if (reset && posts.length === 0) document.getElementById('feed-empty').style.display = 'block';
      offset += posts.length;
      const loadMoreWrap = document.getElementById('load-more-wrap');
      if (posts.length === 12) {
        loadMoreWrap.style.display = 'block';
        loadMoreBtn.disabled = false;
        loadMoreBtn.textContent = 'もっと見る';
      } else {
        loadMoreWrap.style.display = 'none';
      }
      loading = false;
    }

    document.querySelectorAll('.sort-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.sort-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentOrder = tab.dataset.order;
        loadFeed(true);
      });
    });
    document.getElementById('load-more-btn').addEventListener('click', () => loadFeed());

    // ========== 初期化 ==========
    renderZukan();
    loadFeed(true);
  </script>
</body>
</html>
